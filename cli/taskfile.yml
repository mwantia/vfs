version: '3'

tasks:
    default:
        desc: List all available tasks
        cmds:
        - task --list
        silent: true

    init:
        desc: Download and tidy Go module dependencies
        cmds:
        - go mod download
        - go mod tidy

    build:
        desc: Build the VFS CLI binary
        cmds:
        - task: init
        - go build -o build/vfs .

    build-race:
        desc: Build with race detection
        cmds:
        - task: init
        - go build -race -o build/vfs .

    run:
        desc: Run the VFS CLI directly
        cmds:
        - go run main.go

    build-and-run:
        desc: Build and run the VFS CLI
        cmds:
        - task: build
        - ./build/vfs

    install:
        desc: Build and install CLI to /usr/local/bin
        cmds:
        - task: build
        - sudo mv vfs-cli /usr/local/bin/vfs-cli
        - echo "VFS CLI installed to /usr/local/bin/vfs-cli"

    install-local:
        desc: Build and install CLI to ~/bin
        cmds:
        - task: build
        - mkdir -p ~/bin
        - mv vfs-cli ~/bin/vfs-cli
        - echo "VFS CLI installed to ~/bin/vfs-cli"

    test:
        desc: Run all tests
        cmds:
        - go test ./...

    test-verbose:
        desc: Run all tests with verbose output
        cmds:
        - go test -v ./...

    test-race:
        desc: Run tests with race detection
        cmds:
        - go test -race ./...

    fmt:
        desc: Format Go code
        cmds:
        - go fmt ./...

    vet:
        desc: Run go vet
        cmds:
        - go vet ./...

    lint:
        desc: Format code and run vet
        cmds:
        - task: fmt
        - task: vet

    clean:
        desc: Clean build artifacts
        cmds:
        - rm -f vfs-cli
        - rm -f coverage.out coverage.html

    ci:
        desc: Run all CI checks (lint, test, build)
        cmds:
        - task: lint
        - task: test-race
        - task: build
